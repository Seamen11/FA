{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Экономическая инвестиционная модель</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="{% static 'styles/styles.css' %}" rel="stylesheet">
</head>
<body>
<h1>Добро пожаловать!</h1>
<p><a href="{% url 'projects_page' %}">Ввести проекты и рассчитать (JSON)</a></p>
<p><a href="{% url 'enter_projects_page' %}" class="btn btn-primary">Ввести проекты и рассчитать через таблицу</a></p>
<p><a href="{% url 'parameters_page' %}">Задать параметры для модели</a></p>

<div class="container py-5">
    <h2 class="text-center">Инвестиционная модель предприятия</h2>

    <!-- Форма с таблицей проектов -->
    <form method="POST">
        {% csrf_token %}
        <table class="table">
            <thead>
                <tr>
                    <th>Проект</th>
                    <th>Уровни инвестиций</th>
                    <th>Прибыль</th>
                </tr>
            </thead>
            <tbody>
                {% for project in projects %}
                    <tr>
                        <td>Проект {{ forloop.counter }}</td>
                        <td><input type="text" class="form-control" name="project_{{ forloop.counter }}_levels" value="{{ project.levels|join:', ' }}"></td>
                        <td><input type="text" class="form-control" name="project_{{ forloop.counter }}_profits" value="{{ project.profits|join:', ' }}"></td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
        <div class="text-center">
            <button type="submit" class="btn btn-success mt-3">Рассчитать</button>
        </div>
    </form>

    <!-- Результаты расчётов: Появляется только если был POST-запрос -->
    {% if result %}
        <div class="mt-5">
            <h4>Результаты расчётов</h4>
            <p>Максимальная чистая прибыль: {{ result.max_profit }}</p>
            <h5>Стратегия распределения инвестиций:</h5>
            <ul>
                {% for s in result.strategy %}
                    <li>Проект {{ forloop.counter }}: вложить {{ s }} у.е.</li>
                {% endfor %}
            </ul>

            <h5>История состояний:</h5>
            <ul>
                {% for state in result.states %}
                    <li>Этап {{ state.step }}: Вложено {{ state.invested }} у.е., Накопленная прибыль {{ state.profit }} у.е., Остаток бюджета {{ state.remaining_budget }} у.е.</li>
                {% endfor %}
            </ul>

            <h5>Графики</h5>
            <div>
                <img src="data:image/png;base64,{{ result.plot_data }}" alt="Графики">
            </div>
        </div>
    {% endif %}
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
